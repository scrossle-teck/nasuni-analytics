# Filesystem ACL Vulnerability Patterns (snapshot analysis)

This document lists high‑value vulnerability patterns to look for when analysing filesystem ACL snapshots (shallow, estate‑wide view). Each pattern includes quick detection hints (fields available in the dataset) and triage priority.

For detection purposes we treat the following as "admin" identities (or equivalent service/system principals): built-in Administrators and Administrator accounts (e.g. `Administrators`, `Administrator`, `Domain Admins`, `Enterprise Admins`), explicit admin-style groups and aliases observed in the estate (examples: `TECKCOMINCO\G-R-Admin-ALL-Nasuni-Administrator`, `g-r-admin`, `g-r-all`, `g-f-all-full-control`, `nasuni-administrator`), and well-known system SIDs such as `S-1-5-32-544` (Builtin\Administrators), `S-1-5-18` (NT AUTHORITY\SYSTEM) and the appliance root SID `S-1-22-1-0`. These patterns are used when the guide says "admin" or to exclude expected admin/service principals from sensitivity hits.

## High Priority

- Everyone / Authenticated FullControl
  - Detection: `ace_name` contains `Everyone` or `Authenticated` and `ace_mask` indicates FullControl.
  - Fields: `ace_name`, `ace_mask`, `folder_path`.
  - Action: Immediate remediation.

- Non-Admin Groups or Users with FullControl
  - Detection: `ace_name` contains `Domain Users` or generic large group names + `ace_mask` FullControl.
  - Fields: `ace_name`, `ace_mask`, `folder_path`, `ace_inherited`.
  - Action: Validate business need; narrow group or replace with specific groups.

- Orphaned / Unresolved SIDs
  - Detection: `ace_sid` populated but `ace_name` empty or left as raw SID string.
  - Fields: `ace_sid`, `ace_name`, `folder_path`.
  - Action: Resolve SIDs (domain lookup) or remove stale entries; treat as high risk on sensitive folders.

- Service / Computer Accounts with Broad Rights
  - Detection: `ace_name` contains `$`, `svc`, `service`, or machine-like names with broad `ace_mask`.
  - Fields: `ace_name`, `ace_mask`, `ace_sid`.
  - Action: Validate, restrict to specific service principals if required.

## Important / Investigate

- Broad inherited ACEs (wide propagation)
  - Detection: many `folder_path` entries under the same ancestor have `ace_inherited=True` for a broad identity.
  - Fields: `folder_path`, `ace_inherited`, `ace_name`.
  - Action: Find ancestor ACL; tighten inheritance or break at right level.

- High ACL complexity / excessive ACE count
  - Detection: folders with unusually many ACE rows in the dataset.
  - Fields: aggregated ACE count per `folder_path`.
  - Action: Simplify ACLs to reduce misconfiguration risk.

- Sensitive keywords exposed (English + Spanish + abbreviations)
  - Detection: folder path contains keywords (HR, Recursos Humanos, Payroll/Nómina, Finance/Finanzas, Legal/Contratos, PII, Health, SOX, Audit, etc.) and ACE shows broad perms.
  - Fields: `folder_path`, `ace_name`, `ace_mask`.
  - Action: Prioritize PII / Payroll / Legal for remediation.

## Operational / Remediation Checks

- Share root lacking admin FullControl
  - Detection: at share root, no `ace_name` matching admin/service admin patterns with FullControl.
  - Fields: `folder_path` (share root), `ace_name`, `ace_mask`.
  - Action: Restore correct admin ownership/permissions.

- Backup/archive/export shares writable by broad identities
  - Detection: folder names like `backup`, `respaldo`, `archive`, `export` + broad ACEs.
  - Fields: `folder_path`, `ace_name`, `ace_mask`.
  - Action: Restrict backup stores.

- Executable / script folders writable by broad identities
  - Detection: folder names containing `scripts`, `bin`, `deploy`, `install` with write/full perms for broad principals.
  - Fields: `folder_path`, `ace_mask`, `ace_name`.
  - Action: Lock down write permissions.

## Temporal / Change Detection (recommended)

- Mass permission changes / spike detection
  - Detection: run-to-run diffs showing bulk additions/removals of broad ACEs.
  - Fields: requires two snapshot runs; compare ACE sets by `folder_path` + `ace_sid`/`ace_name`.
  - Action: Alert on large or suspicious permission changes.

- Newly introduced Everyone/Authenticated ACEs
  - Detection: broad ACE present in current run that was not present in previous snapshot.

## Quick actionable next steps (from this dataset)

1. Produce a deduplicated one-row-per-folder prioritized list that includes: sensitive keyword category, presence of `Everyone` or `Domain Users`, whether ACE is inherited, and ACE count. Use that as the remediation backlog.
2. Produce an orphaned-SID report: list unique `ace_sid` values with missing or unresolved `ace_name` for manual translation.
3. Implement a run-to-run diff (even a simple file-based CSV diff) to detect newly added broad ACEs.

## Fields to use from the Parquet/CSV exports

- `folder_path`, `ace_name`, `ace_sid`, `ace_mask`, `ace_inherited`, plus run metadata (timestamp/run-id) if available.

## Notes

- This guidance assumes a broad, shallow snapshot of filesystem ACLs (no AD lookups, no share-level metadata beyond path names). Where possible, enrich with SID→name translation and run history for better triage.

---

Generated for the `nasuni-analytics` project as a starting point; amend as needed.
